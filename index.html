<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes and Tasks App</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jkanban/1.2.3/jkanban.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jkanban/1.2.3/jkanban.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            background-color: #f4f5f7;
        }
        .task-done {
            text-decoration: line-through;
        }
        .hidden {
            display: none;
        }
        .note {
            margin-bottom: 20px;
        }
        .note-content {
            white-space: pre-wrap;
        }
        .kanban-board {
            margin-top: 20px;
        }
        .kanban-item {
            padding: 10px;
            margin: 5px;
            background: #fff;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Notes and Tasks App</span>
                <div class="mdl-layout-spacer"></div>
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" href="#" onclick="showPage('notes')">Notes</a>
                    <a class="mdl-navigation__link" href="#" onclick="showPage('tasks')">Tasks</a>
                    <a class="mdl-navigation__link" href="#" onclick="showPage('kanban')">Kanban</a>
                </nav>
            </div>
        </header>
        <main class="mdl-layout__content">
            <div id="notes-page">
                <h2 class="mdl-typography--title">Notes</h2>
                <div id="notes-list"></div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="showNoteForm()">Add Note</button>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent" onclick="deleteAllNotesAndTasks()">Delete All Notes and Tasks</button>
                <div id="note-form" class="hidden">
                    <h3 class="mdl-typography--title">New Note</h3>
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" id="note-title" placeholder="Title">
                    </div>
                    <div class="mdl-textfield mdl-js-textfield">
                        <textarea class="mdl-textfield__input" id="note-content" placeholder="Content"></textarea>
                    </div>
                    <div id="note-tasks"></div>
                    <button class="mdl-button mdl-js-button mdl-button--raised" onclick="addNoteTask()">Add Task</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="saveNote()">Save Note</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent" onclick="hideNoteForm()">Cancel</button>
                </div>
            </div>
            <div id="tasks-page" class="hidden">
                <h2 class="mdl-typography--title">Tasks</h2>
                <div id="tasks-list" class="mdl-list"></div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="showTaskForm()">Add Task</button>
                <div id="task-form" class="hidden">
                    <h3 class="mdl-typography--title">New Task</h3>
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="text" id="task-desc" placeholder="Description">
                    </div>
                    <div class="mdl-textfield mdl-js-textfield">
                        <input class="mdl-textfield__input" type="date" id="task-due-date">
                    </div>
                    <div class="mdl-textfield mdl-js-textfield">
                        <select class="mdl-textfield__input" id="task-status">
                            <option value="todo">To Do</option>
                            <option value="high-priority">High Priority</option>
                        </select>
                    </div>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="saveTask()">Save Task</button>
                    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent" onclick="hideTaskForm()">Cancel</button>
                </div>
            </div>
            <div id="kanban-page" class="hidden">
                <h2 class="mdl-typography--title">Kanban Board</h2>
                <div id="kanban-board" class="kanban-board"></div>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
    <script>
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let editingNoteId = null;
        let editingTaskId = null;
        const converter = new showdown.Converter();
        let kanban;

        document.addEventListener("DOMContentLoaded", function() {
            showPage('notes');
        });

        function showPage(page) {
            document.getElementById('notes-page').classList.add('hidden');
            document.getElementById('tasks-page').classList.add('hidden');
            document.getElementById('kanban-page').classList.add('hidden');
            document.getElementById(page + '-page').classList.remove('hidden');
            if (page === 'notes') {
                displayNotes();
            } else if (page === 'tasks') {
                displayTasks();
            } else if (page === 'kanban') {
                displayKanban();
            }
        }

        function displayNotes() {
            const notesList = document.getElementById('notes-list');
            notesList.innerHTML = '';
            notes.forEach(note => {
                const noteDiv = document.createElement('div');
                noteDiv.classList.add('note');
                noteDiv.innerHTML = `
                    <div class="mdl-card mdl-shadow--2dp">
                        <div class="mdl-card__title">
                            <h2 class="mdl-card__title-text">${note.title}</h2>
                        </div>
                        <div class="mdl-card__supporting-text note-content">${converter.makeHtml(note.content)}</div>
                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--icon" onclick="editNote(${note.id})">
                                <i class="material-icons">edit</i>
                            </button>
                            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent" onclick="deleteNote(${note.id})">
                                <i class="material-icons">delete</i>
                            </button>
                        </div>
                    </div>
                `;
                notesList.appendChild(noteDiv);
            });
        }

        function showNoteForm(note) {
            document.getElementById('note-form').classList.remove('hidden');
            document.getElementById('note-tasks').innerHTML = '';
            if (note) {
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
                note.tasks.forEach(taskId => {
                    const task = tasks.find(t => t.id === taskId);
                    addNoteTask(task);
                });
                editingNoteId = note.id;
            } else {
                document.getElementById('note-title').value = '';
                document.getElementById('note-content').value = '';
                editingNoteId = null;
            }
        }

        function hideNoteForm() {
            document.getElementById('note-form').classList.add('hidden');
        }

        function saveNote() {
            const title = document.getElementById('note-title').value;
            const content = document.getElementById('note-content').value;
            const taskElements = document.querySelectorAll('#note-tasks .task');
            const noteTasks = [];
            taskElements.forEach(taskElement => {
                const taskId = taskElement.dataset.id;
                if (taskId) {
                    noteTasks.push(parseInt(taskId));
                } else {
                    const task = { id: Date.now() + Math.random(), description: taskElement.querySelector('.task-desc').value, isDone: false, dueDate: taskElement.querySelector('.task-due-date').value, status: 'todo' };
                    tasks.push(task);
                    noteTasks.push(task.id);
                }
            });
            if (editingNoteId) {
                notes = notes.map(n => n.id === editingNoteId ? { id: editingNoteId, title, content, tasks: noteTasks } : n);
            } else {
                const note = { id: Date.now(), title, content, tasks: noteTasks };
                notes.push(note);
            }
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            hideNoteForm();
            displayNotes();
            displayTasks();
            displayKanban();
        }

        function addNoteTask(task) {
            const noteTasksDiv = document.getElementById('note-tasks');
            const taskDiv = document.createElement('div');
            taskDiv.classList.add('task');
            taskDiv.dataset.id = task ? task.id : '';
            taskDiv.innerHTML = `
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input task-desc" type="text" placeholder="Task description" value="${task ? task.description : ''}">
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input task-due-date" type="date" value="${task ? task.dueDate : ''}">
                </div>
            `;
            noteTasksDiv.appendChild(taskDiv);
        }

        function editNote(id) {
            const note = notes.find(n => n.id === id);
            showNoteForm(note);
        }

        function deleteNote(id) {
            notes = notes.filter(n => n.id !== id);
            localStorage.setItem('notes', JSON.stringify(notes));
            displayNotes();
            displayTasks();
            displayKanban();
        }

        function displayTasks() {
            const tasksList = document.getElementById('tasks-list');
            tasksList.innerHTML = '';
            tasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.classList.add('mdl-list__item');
                taskDiv.dataset.id = task.id;
                taskDiv.innerHTML = `
                    <span class="mdl-list__item-primary-content">
                        <span>${task.description}</span>
                        <span class="mdl-list__item-sub-title">${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</span>
                    </span>
                    <span class="mdl-list__item-secondary-action">
                        <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="list-checkbox-${task.id}">
                            <input type="checkbox" id="list-checkbox-${task.id}" class="mdl-checkbox__input" ${task.isDone ? 'checked' : ''} onclick="toggleTaskDone(${task.id})">
                        </label>
                        <button class="mdl-button mdl-js-button mdl-button--icon" onclick="editTask(${task.id})">
                            <i class="material-icons">edit</i>
                        </button>
                        <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent" onclick="deleteTask(${task.id})">
                            <i class="material-icons">delete</i>
                        </button>
                    </span>
                `;
                tasksList.appendChild(taskDiv);
            });
        }

        function showTaskForm(task) {
            document.getElementById('task-form').classList.remove('hidden');
            if (task) {
                document.getElementById('task-desc').value = task.description;
                document.getElementById('task-due-date').value = task.dueDate;
                document.getElementById('task-status').value = task.status;
                editingTaskId = task.id;
            } else {
                document.getElementById('task-desc').value = '';
                document.getElementById('task-due-date').value = '';
                document.getElementById('task-status').value = 'todo';
                editingTaskId = null;
            }
        }

        function hideTaskForm() {
            document.getElementById('task-form').classList.add('hidden');
        }

        function saveTask() {
            const description = document.getElementById('task-desc').value;
            const dueDate = document.getElementById('task-due-date').value;
            const status = document.getElementById('task-status').value;
            if (editingTaskId) {
                tasks = tasks.map(t => t.id === editingTaskId ? { ...t, description, dueDate, status } : t);
            } else {
                const task = { id: Date.now() + Math.random(), description, isDone: false, dueDate, status };
                tasks.push(task);
            }
            localStorage.setItem('tasks', JSON.stringify(tasks));
            hideTaskForm();
            displayTasks();
            displayNotes();
            displayKanban();
        }

        function toggleTaskDone(id) {
            const task = tasks.find(t => t.id === id);
            task.isDone = !task.isDone;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            displayTasks();
            displayNotes();
            displayKanban();
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            showTaskForm(task);
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            notes = notes.map(note => {
                note.tasks = note.tasks.filter(taskId => taskId !== id);
                return note;
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('notes', JSON.stringify(notes));
            displayTasks();
            displayNotes();
            displayKanban();
        }

        function deleteAllNotesAndTasks() {
            if (confirm("Are you sure you want to delete all notes and tasks? This action cannot be undone.")) {
                notes = [];
                tasks = [];
                localStorage.setItem('notes', JSON.stringify(notes));
                localStorage.setItem('tasks', JSON.stringify(tasks));
                displayNotes();
                displayTasks();
                displayKanban();
            }
        }

        function displayKanban() {
            if (!kanban) {
                kanban = new jKanban({
                    element: '#kanban-board',
                    gutter: '15px',
                    widthBoard: '250px',
                    boards: [
                        {
                            id: '_todo',
                            title: 'To Do',
                            class: 'info, good',
                            item: tasks.filter(t => t.status === 'todo').map(task => ({
                                title: `${task.description} - ${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}`,
                                id: task.id
                            }))
                        },
                        {
                            id: '_highpriority',
                            title: 'High Priority',
                            class: 'warning',
                            item: tasks.filter(t => t.status === 'high-priority').map(task => ({
                                title: `${task.description} - ${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}`,
                                id: task.id
                            }))
                        }
                    ]
                });
            } else {
                kanban.removeBoard('_todo');
                kanban.removeBoard('_highpriority');
                kanban.addBoards([
                    {
                        id: '_todo',
                        title: 'To Do',
                        class: 'info, good',
                        item: tasks.filter(t => t.status === 'todo').map(task => ({
                            title: `${task.description} - ${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}`,
                            id: task.id
                        }))
                    },
                    {
                        id: '_highpriority',
                        title: 'High Priority',
                        class: 'warning',
                        item: tasks.filter(t => t.status === 'high-priority').map(task => ({
                            title: `${task.description} - ${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}`,
                            id: task.id
                        }))
                    }
                ]);
            }
        }

        // Initial display
        showPage('notes');
    </script>
</body>
</html>
