<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes and Tasks App</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <script src="https://unpkg.com/@mui/material@5.15.21/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/@emotion/react@11.9.3/umd/emotion-react.development.js"></script>
    <script src="https://unpkg.com/@emotion/styled@11.9.3/umd/emotion-styled.development.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            background-color: #f4f5f7;
        }
        .task-done {
            text-decoration: line-through;
        }
        .hidden {
            display: none;
        }
        .note {
            margin-bottom: 20px;
        }
        .note-content {
            white-space: pre-wrap;
        }
        .kanban-board {
            display: flex;
            gap: 20px;
        }
        .kanban-column {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #ffffff;
            border-radius: 4px;
        }
        .kanban-column h3 {
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
    <script>
        const { useState, useEffect } = React;
        const { AppBar, Tabs, Tab, Typography, Box, Button, TextField, Checkbox, FormControlLabel, MenuItem, Select, InputLabel, FormControl, Container, Paper, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } = MaterialUI;
        const converter = new showdown.Converter();

        function App() {
            const [notes, setNotes] = useState(JSON.parse(localStorage.getItem('notes')) || []);
            const [tasks, setTasks] = useState(JSON.parse(localStorage.getItem('tasks')) || []);
            const [currentPage, setCurrentPage] = useState('notes');
            const [noteFormOpen, setNoteFormOpen] = useState(false);
            const [taskFormOpen, setTaskFormOpen] = useState(false);
            const [editingNote, setEditingNote] = useState(null);
            const [editingTask, setEditingTask] = useState(null);

            useEffect(() => {
                localStorage.setItem('notes', JSON.stringify(notes));
            }, [notes]);

            useEffect(() => {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }, [tasks]);

            const handleTabChange = (event, newValue) => {
                setCurrentPage(newValue);
            };

            const handleNoteFormOpen = (note = null) => {
                setEditingNote(note);
                setNoteFormOpen(true);
            };

            const handleNoteFormClose = () => {
                setNoteFormOpen(false);
            };

            const handleTaskFormOpen = (task = null) => {
                setEditingTask(task);
                setTaskFormOpen(true);
            };

            const handleTaskFormClose = () => {
                setTaskFormOpen(false);
            };

            const saveNote = (title, content, noteTasks) => {
                const noteId = editingNote ? editingNote.id : Date.now();
                const newNote = { id: noteId, title, content, tasks: noteTasks };
                setNotes(prevNotes => editingNote ? prevNotes.map(n => n.id === noteId ? newNote : n) : [...prevNotes, newNote]);
                handleNoteFormClose();
            };

            const saveTask = (description, dueDate, status) => {
                const taskId = editingTask ? editingTask.id : Date.now();
                const newTask = { id: taskId, description, dueDate, status: status || 'todo', isDone: false };
                setTasks(prevTasks => editingTask ? prevTasks.map(t => t.id === taskId ? newTask : t) : [...prevTasks, newTask]);
                handleTaskFormClose();
            };

            const deleteNote = (id) => {
                setNotes(prevNotes => prevNotes.filter(n => n.id !== id));
                setTasks(prevTasks => prevTasks.filter(t => !notes.find(note => note.tasks.includes(t.id))));
            };

            const deleteTask = (id) => {
                setTasks(prevTasks => prevTasks.filter(t => t.id !== id));
                setNotes(prevNotes => prevNotes.map(note => ({ ...note, tasks: note.tasks.filter(taskId => taskId !== id) })));
            };

            const toggleTaskDone = (id) => {
                setTasks(prevTasks => prevTasks.map(t => t.id === id ? { ...t, isDone: !t.isDone } : t));
            };

            const renderNotes = () => (
                <Container>
                    {notes.map(note => (
                        <Paper key={note.id} style={{ margin: '20px 0', padding: '20px' }}>
                            <Typography variant="h5">{note.title}</Typography>
                            <Typography variant="body1" className="note-content" dangerouslySetInnerHTML={{ __html: converter.makeHtml(note.content) }} />
                            <Box>
                                {note.tasks.map(taskId => {
                                    const task = tasks.find(t => t.id === taskId);
                                    return (
                                        <Box key={task.id} display="flex" alignItems="center">
                                            <Checkbox checked={task.isDone} onChange={() => toggleTaskDone(task.id)} />
                                            <Typography variant="body1" className={task.isDone ? 'task-done' : ''}>{task.description}</Typography>
                                            <Typography variant="body2" style={{ marginLeft: 'auto' }}>{task.dueDate}</Typography>
                                            <Button onClick={() => handleTaskFormOpen(task)}>Edit</Button>
                                            <Button onClick={() => deleteTask(task.id)} color="secondary">Delete</Button>
                                        </Box>
                                    );
                                })}
                            </Box>
                            <Box display="flex" justifyContent="space-between" marginTop="20px">
                                <Button onClick={() => handleNoteFormOpen(note)}>Edit</Button>
                                <Button onClick={() => deleteNote(note.id)} color="secondary">Delete</Button>
                            </Box>
                        </Paper>
                    ))}
                </Container>
            );

            const renderTasks = () => (
                <Container>
                    {tasks.map(task => (
                        <Paper key={task.id} style={{ margin: '20px 0', padding: '20px' }}>
                            <Box display="flex" alignItems="center">
                                <Checkbox checked={task.isDone} onChange={() => toggleTaskDone(task.id)} />
                                <Typography variant="body1" className={task.isDone ? 'task-done' : ''}>{task.description}</Typography>
                                <Typography variant="body2" style={{ marginLeft: 'auto' }}>{task.dueDate}</Typography>
                                <Typography variant="body2" style={{ marginLeft: '10px' }}>{task.status}</Typography>
                                <Button onClick={() => handleTaskFormOpen(task)}>Edit</Button>
                                <Button onClick={() => deleteTask(task.id)} color="secondary">Delete</Button>
                            </Box>
                        </Paper>
                    ))}
                </Container>
            );

            const renderKanban = () => (
                <Container className="kanban-board">
                    <Box className="kanban-column">
                        <Typography variant="h6">To Do</Typography>
                        {tasks.filter(t => t.status === 'todo').map(task => (
                            <Paper key={task.id} style={{ margin: '10px 0', padding: '10px' }}>
                                <Box display="flex" alignItems="center">
                                    <Checkbox checked={task.isDone} onChange={() => toggleTaskDone(task.id)} />
                                    <Typography variant="body1" className={task.isDone ? 'task-done' : ''}>{task.description}</Typography>
                                    <Typography variant="body2" style={{ marginLeft: 'auto' }}>{task.dueDate}</Typography>
                                    <Button onClick={() => handleTaskFormOpen(task)}>Edit</Button>
                                    <Button onClick={() => deleteTask(task.id)} color="secondary">Delete</Button>
                                </Box>
                            </Paper>
                        ))}
                    </Box>
                    <Box className="kanban-column">
                        <Typography variant="h6">High Priority</Typography>
                                {tasks.filter(t => t.status === 'high-priority').map(task => (
                            <Paper key={task.id} style={{ margin: '10px 0', padding: '10px' }}>
                                <Box display="flex" alignItems="center">
                                    <Checkbox checked={task.isDone} onChange={() => toggleTaskDone(task.id)} />
                                    <Typography variant="body1" className={task.isDone ? 'task-done' : ''}>{task.description}</Typography>
                                    <Typography variant="body2" style={{ marginLeft: 'auto' }}>{task.dueDate}</Typography>
                                    <Button onClick={() => handleTaskFormOpen(task)}>Edit</Button>
                                    <Button onClick={() => deleteTask(task.id)} color="secondary">Delete</Button>
                                </Box>
                            </Paper>
                        ))}
                    </Box>
                </Container>
            );

            const renderNoteForm = () => {
                const [title, setTitle] = useState(editingNote ? editingNote.title : '');
                const [content, setContent] = useState(editingNote ? editingNote.content : '');
                const [noteTasks, setNoteTasks] = useState(editingNote ? editingNote.tasks : []);

                const addNoteTask = () => {
                    const newTask = { id: Date.now() + Math.random(), description: '', dueDate: '', status: 'todo', isDone: false };
                    setNoteTasks([...noteTasks, newTask.id]);
                    setTasks([...tasks, newTask]);
                };

                const updateNoteTask = (taskId, description, dueDate) => {
                    setTasks(prevTasks => prevTasks.map(t => t.id === taskId ? { ...t, description, dueDate } : t));
                };

                return (
                    <Dialog open={noteFormOpen} onClose={handleNoteFormClose} fullWidth>
                        <DialogTitle>{editingNote ? 'Edit Note' : 'New Note'}</DialogTitle>
                        <DialogContent>
                            <DialogContentText>
                                {editingNote ? 'Edit the details of your note.' : 'Enter the details for your new note.'}
                            </DialogContentText>
                            <TextField autoFocus margin="dense" label="Title" fullWidth value={title} onChange={e => setTitle(e.target.value)} />
                            <TextField margin="dense" label="Content" fullWidth multiline rows={4} value={content} onChange={e => setContent(e.target.value)} />
                            {noteTasks.map(taskId => {
                                const task = tasks.find(t => t.id === taskId);
                                return (
                                    <Box key={task.id} display="flex" alignItems="center" marginTop="10px">
                                        <TextField label="Task Description" fullWidth value={task.description} onChange={e => updateNoteTask(task.id, e.target.value, task.dueDate)} />
                                        <TextField type="date" fullWidth value={task.dueDate} onChange={e => updateNoteTask(task.id, task.description, e.target.value)} style={{ marginLeft: '10px' }} />
                                    </Box>
                                );
                            })}
                            <Button onClick={addNoteTask} color="primary" style={{ marginTop: '10px' }}>Add Task</Button>
                        </DialogContent>
                        <DialogActions>
                            <Button onClick={handleNoteFormClose} color="secondary">Cancel</Button>
                            <Button onClick={() => saveNote(title, content, noteTasks)} color="primary">Save</Button>
                        </DialogActions>
                    </Dialog>
                );
            };

            const renderTaskForm = () => {
                const [description, setDescription] = useState(editingTask ? editingTask.description : '');
                const [dueDate, setDueDate] = useState(editingTask ? editingTask.dueDate : '');
                const [status, setStatus] = useState(editingTask ? editingTask.status : 'todo');

                return (
                    <Dialog open={taskFormOpen} onClose={handleTaskFormClose} fullWidth>
                        <DialogTitle>{editingTask ? 'Edit Task' : 'New Task'}</DialogTitle>
                        <DialogContent>
                            <DialogContentText>
                                {editingTask ? 'Edit the details of your task.' : 'Enter the details for your new task.'}
                            </DialogContentText>
                            <TextField autoFocus margin="dense" label="Description" fullWidth value={description} onChange={e => setDescription(e.target.value)} />
                            <TextField type="date" margin="dense" fullWidth value={dueDate} onChange={e => setDueDate(e.target.value)} />
                            <FormControl fullWidth margin="dense">
                                <InputLabel>Status</InputLabel>
                                <Select value={status} onChange={e => setStatus(e.target.value)}>
                                    <MenuItem value="todo">To Do</MenuItem>
                                    <MenuItem value="high-priority">High Priority</MenuItem>
                                </Select>
                            </FormControl>
                        </DialogContent>
                        <DialogActions>
                            <Button onClick={handleTaskFormClose} color="secondary">Cancel</Button>
                            <Button onClick={() => saveTask(description, dueDate, status)} color="primary">Save</Button>
                        </DialogActions>
                    </Dialog>
                );
            };

            return (
                <Container>
                    <AppBar position="static">
                        <Tabs value={currentPage} onChange={handleTabChange} aria-label="simple tabs example">
                            <Tab label="Notes" value="notes" />
                            <Tab label="Tasks" value="tasks" />
                            <Tab label="Kanban" value="kanban" />
                        </Tabs>
                    </AppBar>
                    <Box hidden={currentPage !== 'notes'}>
                        <Typography variant="h4" style={{ marginTop: '20px' }}>Notes</Typography>
                        <Button onClick={() => handleNoteFormOpen()} variant="contained" color="primary" style={{ margin: '20px 0' }}>Add Note</Button>
                        {renderNotes()}
                    </Box>
                    <Box hidden={currentPage !== 'tasks'}>
                        <Typography variant="h4" style={{ marginTop: '20px' }}>Tasks</Typography>
                        <Button onClick={() => handleTaskFormOpen()} variant="contained" color="primary" style={{ margin: '20px 0' }}>Add Task</Button>
                        {renderTasks()}
                    </Box>
                    <Box hidden={currentPage !== 'kanban'}>
                        <Typography variant="h4" style={{ marginTop: '20px' }}>Kanban Board</Typography>
                        {renderKanban()}
                    </Box>
                    {noteFormOpen && renderNoteForm()}
                    {taskFormOpen && renderTaskForm()}
                </Container>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
