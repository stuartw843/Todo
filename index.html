<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes and Tasks App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .hidden {
            display: none;
        }
        .task-done {
            text-decoration: line-through;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 10px;
        }
        textarea {
            width: 100%;
            height: 100px;
            box-sizing: border-box;
        }
        .note, .task-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .task {
            display: flex;
            flex-direction: column;
        }
        .task-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .task-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        .task-details {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        .task-buttons {
            display: flex;
            justify-content: space-between;
        }
        .danger-button {
            background-color: red;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        input[type="text"], input[type="date"], select {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 8px;
            margin-bottom: 10px;
            width: 100%;
        }
        .task-button {
            margin-left: 5px;
            padding: 5px;
            width: 30px;
        }
        .task-action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        .status {
            font-weight: bold;
            color: #007BFF;
        }
        .related-note {
            font-style: italic;
            color: #555;
        }
        @media (min-width: 600px) {
            .task-action-buttons button {
                width: 48%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Notes and Tasks App</h1>
        <nav>
            <button onclick="showPage('notes')">Notes</button>
            <button onclick="showPage('tasks')">Tasks</button>
        </nav>
        <div id="notes-page">
            <h2>Notes</h2>
            <input type="text" id="search-input" placeholder="Search Notes" oninput="searchNotes()">
            <div id="notes-list"></div>
            <button onclick="showNoteForm()">Add Note</button>
            <button class="danger-button" onclick="deleteAllNotesAndTasks()">Delete All Notes and Tasks</button>
            <div id="note-form" class="hidden">
                <h3>New Note</h3>
                <input type="text" id="note-title" placeholder="Title"><br>
                <textarea id="note-content" placeholder="Content"></textarea><br>
                <div id="note-tasks"></div>
                <button onclick="addNoteTask()">Add Task</button><br>
                <button onclick="saveNote()">Save Note</button>
                <button onclick="hideNoteForm()">Cancel</button>
            </div>
        </div>
        <div id="tasks-page" class="hidden">
            <h2>High Impact Tasks</h2>
            <div id="high-impact-tasks"></div>
            <h2>Todo Tasks</h2>
            <div id="todo-tasks"></div>
            <h2>Done Tasks</h2>
            <div id="done-tasks"></div>
            <button onclick="showTaskForm()">Add Task</button>
            <div id="task-form" class="hidden">
                <h3>New Task</h3>
                <input type="text" id="task-desc" placeholder="Description"><br>
                <input type="date" id="task-due-date"><br>
                <select id="task-status">
                    <option value="High Impact">High Impact</option>
                    <option value="Todo">Todo</option>
                </select>
                <button onclick="saveTask()">Save Task</button>
                <button onclick="hideTaskForm()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.min.js"></script>
    <script>
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        const statuses = ["High Impact", "Todo"];
        let editingNoteId = null;
        let editingTaskId = null;
        const converter = new showdown.Converter();
        let fuse;

        function initFuse() {
            fuse = new Fuse(notes, {
                keys: ['title', 'content'],
                threshold: 0.3
            });
        }

        function showPage(page) {
            document.getElementById('notes-page').classList.add('hidden');
            document.getElementById('tasks-page').classList.add('hidden');
            document.getElementById(page + '-page').classList.remove('hidden');
            if (page === 'notes') {
                displayNotes();
            } else if (page === 'tasks') {
                displayTasks();
            }
        }

        function displayNotes(filteredNotes = notes) {
            const notesList = document.getElementById('notes-list');
            notesList.innerHTML = '';
            filteredNotes.forEach(note => {
                const noteDiv = document.createElement('div');
                noteDiv.classList.add('note');
                noteDiv.innerHTML = `
                    <h3>${note.title}</h3>
                    <div>${converter.makeHtml(note.content)}</div>
                    <ul>
                        ${note.tasks.map(taskId => {
                            const task = tasks.find(t => t.id === taskId);
                            return `<li class="task">
                                <div class="task-header">
                                    <input type="checkbox" ${task.isDone ? 'checked' : ''} onclick="toggleTaskDone(${task.id})">
                                    <span class="task-title ${task.isDone ? 'task-done' : ''}">${task.description}</span>
                                    <div class="task-buttons">
                                        <button class="task-button" onclick="editTask(${task.id})"><i class="fas fa-edit"></i></button>
                                        <button class="task-button" onclick="deleteTask(${task.id})"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                                <div class="task-details">
                                    <span>${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</span>
                                    <span class="status">Status: ${task.status}</span>
                                    <span class="related-note">${relatedNoteTitle}</span>
                                </div>
                            </li>`;
                        }).join('')}
                    </ul>
                    <button class="task-button" onclick="editNote(${note.id})"><i class="fas fa-edit"></i></button>
                    <button class="task-button" onclick="deleteNote(${note.id})"><i class="fas fa-trash"></i></button>
                `;
                notesList.appendChild(noteDiv);
            });
        }

        function searchNotes() {
            const searchTerm = document.getElementById('search-input').value;
            if (!searchTerm) {
                displayNotes(notes);
                return;
            }
            const results = fuse.search(searchTerm);
            const filteredNotes = results.map(result => result.item);
            displayNotes(filteredNotes);
        }

        function showNoteForm(note) {
            document.getElementById('note-form').classList.remove('hidden');
            document.getElementById('note-tasks').innerHTML = '';
            if (note) {
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
                note.tasks.forEach(taskId => {
                    const task = tasks.find(t => t.id === taskId);
                    addNoteTask(task);
                });
                editingNoteId = note.id;
            } else {
                document.getElementById('note-title').value = '';
                document.getElementById('note-content').value = '';
                editingNoteId = null;
            }
        }

        function hideNoteForm() {
            document.getElementById('note-form').classList.add('hidden');
        }

        function saveNote() {
            const title = document.getElementById('note-title').value;
            const content = document.getElementById('note-content').value;
            const taskElements = document.querySelectorAll('#note-tasks .task');
            const noteTasks = [];
            taskElements.forEach(taskElement => {
                const taskId = taskElement.dataset.id;
                if (taskId) {
                    noteTasks.push(parseInt(taskId));
                } else {
                    const task = { id: Date.now() + Math.random(), description: taskElement.querySelector('.task-desc').value, isDone: false, dueDate: taskElement.querySelector('.task-due-date').value, status: taskElement.querySelector('.task-status').value };
                    tasks.push(task);
                    noteTasks.push(task.id);
                }
            });
            if (editingNoteId) {
                notes = notes.map(n => n.id === editingNoteId ? { id: editingNoteId, title, content, tasks: noteTasks } : n);
            } else {
                const note = { id: Date.now(), title, content, tasks: noteTasks };
                notes.push(note);
            }
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('tasks', JSON.stringify(tasks));
            initFuse();
            hideNoteForm();
            displayNotes();
            displayTasks();
        }

        function addNoteTask(task) {
            const noteTasksDiv = document.getElementById('note-tasks');
            const taskDiv = document.createElement('div');
            taskDiv.classList.add('task');
            taskDiv.dataset.id = task ? task.id : '';
            taskDiv.innerHTML = `
                <input type="text" class="task-desc" placeholder="Task description" value="${task ? task.description : ''}">
                <input type="date" class="task-due-date" value="${task ? task.dueDate : ''}">
                <select class="task-status">
                    ${statuses.map(status => `<option value="${status}" ${task && task.status === status ? 'selected' : ''}>${status}</option>`).join('')}
                </select>
            `;
            noteTasksDiv.appendChild(taskDiv);
        }

        function editNote(id) {
            const note = notes.find(n => n.id === id);
            showNoteForm(note);
        }

        function deleteNote(id) {
            notes = notes.filter(n => n.id !== id);
            localStorage.setItem('notes', JSON.stringify(notes));
            initFuse();
            displayNotes();
            displayTasks();
        }

        function displayTasks() {
            const highImpactTasksList = document.getElementById('high-impact-tasks');
            const todoTasksList = document.getElementById('todo-tasks');
            const doneTasksList = document.getElementById('done-tasks');

            highImpactTasksList.innerHTML = '';
            todoTasksList.innerHTML = '';
            doneTasksList.innerHTML = '';

            tasks.forEach(task => {
                const relatedNote = notes.find(note => note.tasks.includes(task.id));
                const relatedNoteTitle = relatedNote ? `Note: ${relatedNote.title}` : '';
                const taskDiv = document.createElement('div');
                taskDiv.classList.add('task-card');
                taskDiv.dataset.id = task.id;
                taskDiv.innerHTML = `
                    <div class="task-header">
                        <input type="checkbox" ${task.isDone ? 'checked' : ''} onclick="toggleTaskDone(${task.id})">
                        <span class="task-title ${task.isDone ? 'task-done' : ''}">${task.description}</span>
                        <div class="task-buttons">
                            <button class="task-button" onclick="editTask(${task.id})"><i class="fas fa-edit"></i></button>
                            <button class="task-button" onclick="deleteTask(${task.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="task-details">
                        <span>${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</span>
                        <span class="status">Status: ${task.status}</span>
                        <span class="related-note">${relatedNoteTitle}</span>
                    </div>
                    <div class="task-action-buttons">
                        <button class="task-button" onclick="changeTaskStatus(${task.id}, 'High Impact')">Move to High Impact</button>
                        <button class="task-button" onclick="changeTaskStatus(${task.id}, 'Todo')">Move to Todo</button>
                    </div>
                `;

                if (task.isDone) {
                    doneTasksList.appendChild(taskDiv);
                } else if (task.status === 'High Impact') {
                    highImpactTasksList.appendChild(taskDiv);
                } else if (task.status === 'Todo') {
                    todoTasksList.appendChild(taskDiv);
                }
            });
        }

        function changeTaskStatus(taskId, newStatus) {
            tasks = tasks.map(task => task.id === taskId ? { ...task, status: newStatus } : task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            displayTasks();
        }

        function showTaskForm(task) {
            document.getElementById('task-form').classList.remove('hidden');
            const statusSelect = document.getElementById('task-status');
            statusSelect.innerHTML = statuses.map(status => `<option value="${status}">${status}</option>`).join('');
            if (task) {
                document.getElementById('task-desc').value = task.description;
                document.getElementById('task-due-date').value = task.dueDate;
                statusSelect.value = task.status;
                editingTaskId = task.id;
            } else {
                document.getElementById('task-desc').value = '';
                document.getElementById('task-due-date').value = '';
                statusSelect.value = 'Todo';
                editingTaskId = null;
            }
        }

        function hideTaskForm() {
            document.getElementById('task-form').classList.add('hidden');
        }

        function saveTask() {
            const description = document.getElementById('task-desc').value;
            const dueDate = document.getElementById('task-due-date').value;
            const status = document.getElementById('task-status').value;
            if (editingTaskId) {
                tasks = tasks.map(t => t.id === editingTaskId ? { ...t, description, dueDate, status } : t);
            } else {
                const task = { id: Date.now() + Math.random(), description, isDone: false, dueDate, status };
                tasks.push(task);
            }
            localStorage.setItem('tasks', JSON.stringify(tasks));
            hideTaskForm();
            displayTasks();
            displayNotes();
        }

        function toggleTaskDone(id) {
            const task = tasks.find(t => t.id === id);
            task.isDone = !task.isDone;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            displayTasks();
            displayNotes();
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            showTaskForm(task);
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            notes = notes.map(note => {
                note.tasks = note.tasks.filter(taskId => taskId !== id);
                return note;
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('notes', JSON.stringify(notes));
            displayTasks();
            displayNotes();
        }

        function deleteAllNotesAndTasks() {
            if (confirm("Are you sure you want to delete all notes and tasks? This action cannot be undone.")) {
                notes = [];
                tasks = [];
                localStorage.setItem('notes', JSON.stringify(notes));
                localStorage.setItem('tasks', JSON.stringify(tasks));
                displayNotes();
                displayTasks();
            }
        }

        // Initial setup
        showPage('notes');
        initFuse();
    </script>
</body>
</html>
